# Greedy Knapsack Algorithm with MPC-safe Operations
#
# This demonstrates valid Stoffel-Lang syntax for:
# - Secret integer handling
# - Branchless conditional selection (MPC-safe)
# - List operations using functions (not methods)
# - Implicit reveal via assignment to clear variables
#
# Algorithm: Greedy selection of items that fit within capacity
# Items are assumed to be sorted by weight (descending)

# Branchless selection for MPC-safe conditional assignment
# condition: 0 or 1 (public), returns a if condition=1, else b
def select(condition: int64, a: secret int64, b: secret int64) -> secret int64:
  return a * condition + b * (1 - condition)

# Greedy knapsack: select items that fit within capacity
# weights: list of secret item weights (sorted descending)
# thresholds: list of public capacity thresholds for each item
# n: number of items
# Returns total weight of selected items
def greedy_knapsack(weights: List[secret int64], thresholds: List[int64], n: int64) -> secret int64:
  var total: secret int64 = 0
  var remaining: int64 = thresholds[0]
  var i: int64 = 0

  while i < n:
    # Get the secret weight for this item
    var w: secret int64 = weights[i]

    # Get the public threshold for this position
    var threshold: int64 = thresholds[i]

    # Check if we can fit this item (public comparison - allowed)
    var fits: int64 = 0
    if remaining >= threshold:
      fits = 1
      remaining = remaining - threshold

    # Add weight if it fits using branchless selection
    # This is MPC-safe: we always execute select(), just with different condition
    total = total + select(fits, w, 0)
    i = i + 1

  return total

main main() -> nil:
  # Build weights list using create_array() and array_push()
  # Note: empty list literal [] is not supported
  var weights: List[secret int64] = create_array()
  array_push(weights, 1000)
  array_push(weights, 800)
  array_push(weights, 500)
  array_push(weights, 300)
  array_push(weights, 100)

  # Public capacity thresholds for decision making
  # These represent the remaining capacity needed to include each item
  var thresholds: List[int64] = create_array()
  array_push(thresholds, 2000)
  array_push(thresholds, 1000)
  array_push(thresholds, 200)
  array_push(thresholds, 0)
  array_push(thresholds, 0)

  var n: int64 = 5
  var result: secret int64 = greedy_knapsack(weights, thresholds, n)

  # Reveal by assigning secret to clear variable
  # This triggers implicit reveal - no .reveal() method needed
  var revealed: int64 = result

  print("Total weight of selected items:")
  # Note: print expects string, so we just print the message
  # In a real program, you'd use a conversion function or different output method
